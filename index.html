<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peticion Forzada</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
      
    </style>
</head>
<body>
       <div class="blur-accelerated"></div>


<div class="body-load" id="bodyLoad">
    <div class="alert-container">
        <h3>&#9888; Solo puedes enviar 3 peticiones</h3>
        </div>
    
        <div class="background-opacity" id="background-opacity"></div>
        <div class="topbar">
            <button class="menu-bars" id="menu">&#9776;</button>
            <h2 id="currentmenu">Peticion Forzada</h2>
        </div>
        <div class="side-menu" id="side-menu">
            <div class="topbar">
            <h1>Menu</h1>
            <button class="menu-bars" id="close-menu">&#9776;</button>
            </div>
            <button class="side-menu-button" type="button" id="home">Inicio</button>
            <button class="side-menu-button" type="button" id="themes">Temas</button>
            <button class="side-menu-button" type="button" id="users">Mijos del server <span class="counter">(8) Registrados</span></button>
            <button class="side-menu-button" type="button" id="account">Iniciar Sesión</button>
            <button class="side-menu-button" type="button" id="worldsettings">Cambiar configuracion del mundo</button>
            <div class="separator">Server Alternativo</div>
            <button class="side-menu-button" type="button" id=""></button>

          <footer>&copy; 2025 El server de los papus</footer>
        </div>
        <div class="theme-container" id="themeContainer">
            <h1>Temas</h1>
            <h3>Selecciona un tema</h3>
            <p id="current-theme">Tema actual: </p>
            <button class="theme-button" type="button" id="modern">Moderno (Recomendado para celulares full premium o PC)</button>
            <button class="theme-button" type="button" id="classic">Clasico (Recomendado para celulares del tianguis)</button>
            <button class="theme-button" type="button" id="close-theme">Cerrar</button>
        </div>
       
    <div class="container">
        
    <h1>Pedir que prendan server</h1>
    <button class="button" type="submit" id="requestButton">Espera...</button>
    <h2 id="estado"></h2>
    <input id="messageInput" type="text" placeholder="Personalizar mensaje" id="messageInput" style="display:none;">
   <div style="display: none;" id="mobile-ui" class="button-container">
    <button type="button" id="refresh">Refrescar</button>
    <button type="button" id="problems">Reportar problemas</button>
    <button type="button" id="fixperf">¿Problemas de Rendimiento?</button>
   </div>
</div>
    <br>

    <br>
    <div class="uptime">
        <h3 id="uptime">Tiempo activo: --d --h --m --s </h3>
        <div class="uptime-bar" id="uptime-bar"></div>
        <p id="health">---%</p>
        <p class="p" id="energy">Estado de energia: --</p>
        <p style="margin: 0; font-size: 12px; color: gray;" id="cookieexp">Expira en: --</p>
    </div>
    
    </div>
    <div class="users-container">
        <div class="users-cards">
            <div class="user-card admin"  user-id="1">
                <p class="user-card-name">WaxiestChunk200</p>
                <p class="user-card-status admin">Estado: No se pudo conectar</p>
                <p class="user-card-moto">Admineando lo admineable desde 2011</p>
            </div>
            <div class="user-card moderator" user-id="2">
                <p class="user-card-name">Tren Lokote Peru</p>
                <p class="user-card-status moderator">Estado: No se pudo conectar</p>
                <p class="user-card-moto">A determinar</p>
            </div>
            <div class="user-card" user-id="3">
                <p class="user-card-name">Pasillas2354 / Dilanh22</p>
                <p class="user-card-status">Estado: No se pudo conectar</p>
                <p class="user-card-moto">A determinar</p>
            </div>
            <div class="user-card" user-id="4">
                <p class="user-card-name">Minivers097</p>
                <p class="user-card-status">Estado: No se pudo conectar</p>
                <p class="user-card-moto">A determinar</p>
            </div>
        <div class="user-card" user-id="5">
            <p class="user-card-name">DREAM56512</p>
            <p class="user-card-status">Estado: No se pudo conectar</p>
            <p class="user-card-moto">A determinar</p>
        </div>
        <div class="user-card" user-id="6">
            <p class="user-card-name">XxjuanxX98754</p>
            <p class="user-card-status">Estado: No se pudo conectar</p>
            <p class="user-card-moto">A determinar</p>
        </div>
        <div class="user-card" user-id="7">
            <p class="user-card-name">Mauricio22881</p>
            <p class="user-card-status">Estado: No se pudo conectar</p>
            <p class="user-card-moto">A determinar</p>
        </div>
        <div class="user-card" user-id="8">
            <p class="user-card-name">Ikereader078747</p>
            <p class="user-card-status">Estado: No se pudo conectar</p>
            <p class="user-card-moto">A determinar</p>
        </div>
      

    </div>
    </div>
    <div class="login-container">
        <h1>Iniciar Sesion</h1>
        <p>Inicia sesion con tu cuenta para poder acceder a funciones adicionales como establecer preferencias de usuario, cambiar paquetes de textura del server, cambiar configuraciones del mundo (Excepto trampas), ser desbaneado más rapido y más.</p>
       <input type="text" id="username" placeholder="Usuario">
       <button type="submit" id="login">Iniciar Sesion</button>

    </div>
    <div class="banned-toast" id="bannedToast">
        <h3>Has sido baneado del servidor.</h3>
        <p>Si crees que esto es un error, contacta a un administrador.</p>
        <p>Si repites este tipo de actividades, tu tiempo ira aumentando segun la gravedad de la infracción.</p>
        <p>Tiempo restante: <span id="banDuration">--</span></p>
        <button id="closeToast">Cerrar</button>

    </div>
    <Div class="worldsettings-container" id="worldsettings">
        <h1>Configuraciones del Mundo</h1>
        <p>Selecciona las configuraciones que deseas aplicar al mundo.</p>
        <p>Se aplicaran las configuraciones en el siguiente reinicio del server o nadie este.</p>
        <label for="difficulty">Dificultad:</label>
        <select id="difficulty">
            <option value="default">Predeterminado</option>
            <option value="peaceful">Pacifico</option>
            <option value="easy">Fácil</option>
            <option value="normal">Normal</option>
            <option value="hard">Difícil</option>
        </select>
        <label for="worldFile">Subir archivo del pack de texturas o comportamiento:</label>
        <input type="file" id="worldFile" accept=".zip,.mcpack">
        <p>Muchos mods en el server pueden afectar el rendimiento. El limite son 3</p>
        <div class="installed-packs">
            <h3>Packs de textura y de comportamiento instalados:</h3>
          <div class="installed-packs-cards-container">
              <div class="installed-pack-card">
                  <IMG src="pack.png" alt="Pack 1"></IMG>
                  <div>Pack 1</div>
                    <div>Instalado por:</div><div id="installedBy1">Usuario</div>
              </div>
              <div class="installed-pack-card">
                  <IMG src="pack.png" alt="Pack 2"></IMG>
                  <div>Pack 2</div>
                  <div>Instalado por:</div><div id="installedBy2">Usuario</div>
              </div>
              <div class="installed-pack-card">
                  <IMG src="pack.png" alt="Pack 3"></IMG>
                  <div>Pack 3</div>
                  <div>Instalado por:</div><div id="installedBy3">Usuario</div>
              </div>
          </div>
          <div class="installed-pack-remove-button-container">
              <button>Eliminar Pack 1</button>
              <button>Eliminar Pack 2</button>
              <button>Eliminar Pack 3</button>
          </div>
        </div>
      <button type="button" id="saveWorldSettings">Guardar Configuraciones</button>
    <!----    <div class="advanced-settings" id="advancedSettings">
            <input type="text" id="newWorldName" placeholder="Ingrese el nombre del nuevo mundo">

            <input type="text" id="worldSeed" placeholder="Ingrese la semilla del mundo">
            <label for="gameMode">Modo de juego:</label>
            <select id="gameMode">
                <option value="survival">Supervivencia</option>
                <option value="creative">Creativo</option>
                <option value="adventure">Aventura</option>
                <option value="spectator">Espectador</option>
                
            </select>
            <input type="checkbox" name="enablecheats" id="enablecheats">
            <label for="enablecheats">Habilitar trucos</label>
        </div>
        
    </Div> ---->

    <script>
        // On page load
      document.onreadystatechange = function() {
            const isWebview = /wv|WebView|MobileApp/i.test(window.navigator.userAgent);

// Update the text based on the detection
const webviewElement = document.getElementById('webview');
const mobui = document.getElementById('mobile-ui');

// Refresh button functionality
const refreshButton = document.getElementById('refresh');
refreshButton.addEventListener('click', function() {
    location.reload(); // Reload the page
});
// Problems button functionality
const problemsButton = document.getElementById('problems');
problemsButton.addEventListener('click', function() {
    window.location.href = 'problemas.html'; //
});
// Fix performance button functionality
const fixperfButton = document.getElementById('fixperf');
   


        // Hide the loading screen after 2 second        // Token and chat ID for Telegram Bot
        const botToken = '7529214947:AAFq5gh_ZvzjNNBtYTSCVJlGwwml5Hy2OYY'; // Replace with your bot token
        const chatId = '7688071745';
        const url = `https://api.telegram.org/bot${botToken}/sendMessage`;

// Login button functionality
        

        var input = document.getElementById("messageInput");
        document.getElementById('requestButton').addEventListener('click', () => {
            // Get the value from the input field
            const inputValue = input.value;
            const message = 'Prende server, ' + inputValue;

            

            const data = {
                chat_id: chatId,
                text: message
            };

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    alert('Mensaje enviado correctamente!');
                } else {
                    alert('Error: ' + data.description);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Fallo al enviar el mensaje.');
            });
        });

        setTimeout(function() {
        const serverAddress = "shopping-turtle.gl.at.ply.gg";
        const serverPort = "49732"; // Bedrock default is 19132
    
    
        // Fetch server status using an external API
        async function checkServerStatus() {
          try {
            const response = await fetch(`https://api.mcsrvstat.us/bedrock/2/${serverAddress}:${serverPort}`);
            const data = await response.json();
            console.log(data);
    
            var estado = document.getElementById("estado");
            var button = document.getElementById("requestButton");
            var messageInput = document.getElementById("messageInput");

    
            if (data.online) {
             estado.innerHTML = "El server esta activo... No hay necesidad de peticion";
             button.style.animation = "none";
             estado.style.color = "green";
             button.toggleAttribute("disabled", true);
             button.style.cursor = "not-allowed";
             button.style.background = "gray";
             button.classList.remove("peticion");
             button.style.pointerEvents = "none";
             button.innerHTML = "No puedes hacer peticion";
            } else {
              estado.innerHTML = "El server esta apagado... Realizar peticion";
              messageInput.style.display = "block";
                estado.style.color = "red";
                button.style.pointerEvents = "auto";
                button.classList.add("peticion");
                button.innerHTML = "Realizar peticion";




                document.getElementById('requestButton').addEventListener('click', function() {
            
        });
            }
          } catch (error) {
        estado.innerHTML = "Error fetching server status";
            estado.style.color = "red";
            console.error("Error fetching server status:", error);
          }
        }
    
        checkServerStatus();
    }, 1000);
    var alertcontainer = document.querySelector('.alert-container');
    // Show the alert past 1AM
    var currentTime = new Date();
    var currentHour = currentTime.getHours();
    if (currentHour >= 1 && currentHour < 7) {
        setTimeout(function() {
            alertcontainer.style.display = 'block';
        }, 3000); // Show after 1 second
        setTimeout(function() {
            alertcontainer.style.display = 'none';
        }, 25000); // Hide after 5 seconds
    }

    async function fetchUptime() {
        try {
       const response = fetch('https://robin-pure-miserably.ngrok-free.app',
        {
    method: 'GET',
    headers: {
        'ngrok-skip-browser-warning': '67890'
    }
        });
        // Check if the response is ok (status in the range 200-299)
        
        
        if (!response.ok) throw new Error('Network response was not ok');
        const html = await response.text();

        // Parse the fetched HTML to extract uptime
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const uptimeText = doc.querySelector('p')?.textContent || 'No se encontro';

        // Log the extracted uptime for debugging
        console.log('Extracted Uptime:', uptimeText);

        // Get the DOM elements
        const uptimeElement = document.getElementById('uptime');
        const uptimeBar = document.getElementById('uptime-bar');

        // Update the uptime text
        if (uptimeElement) {
            uptimeElement.textContent = 'Tiempo activo: ' + uptimeText;
        } else {
            console.error('Element with ID "uptime" not found');
        }
 
        // Uptime bar health calculation in reverse from 100% to 0%
        const uptimeParts = uptimeText.split(' ');
        const uptimeValues = uptimeParts.map(part => parseInt(part) || 0);
        const totalSeconds = (uptimeValues[0] * 86400) + (uptimeValues[1] * 3600) + (uptimeValues[2] * 60) + uptimeValues[3];
        const maxSeconds = 86400 * 4; // Assuming a maximum of 4 days for the bar
        const healthPercentage = Math.max(0, Math.min(100, ((maxSeconds - totalSeconds) / maxSeconds) * 100));
        const healthElement = document.getElementById('health');
        if (healthElement) {
            healthElement.textContent = 'Vida del server: ' + Math.round(healthPercentage) + '%';
            uptimeBar.style.width = healthPercentage + '%';
            uptimeBar.style.transition = 'width 1s ease-in-out';
            uptimeBar.style.backgroundColor = healthPercentage > 40 ? 'seagreen' : (healthPercentage > 20 ? 'yellow' : 'red');
            const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
         
            if (healthPercentage < 5) {
                const message = 'El server esta por apagarse, tiempo activo: ' + uptimeText;

                const data = {
                    chat_id: chatId,
                    text: message
                };
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.ok) {
                        console.log('Mensaje enviado correctamente!');
                    } else {
                        console.error('Error al enviar el mensaje:', data.description);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        } else {
            console.error('Element with ID "health" not found');
        }


        
        // Update the uptime bar
    } catch (error) {
        console.error('Error fetching uptime:', error);
        const uptimeElement = document.getElementById('uptime');
        if (uptimeElement) {
            uptimeElement.textContent = 'No se pudo obtener la informacion...';
        }  
    }
}

// Initial fetch
fetchUptime();

// Refresh uptime every 60 seconds
setInterval(fetchUptime, 60000);

    // Update energy status every 10 seconds
   function updateEnergyStatus() {
        var currentTime = new Date();
        var currentHour = currentTime.getHours();
        if (currentHour >= 3 && currentHour < 7) {
            energy.innerHTML = "Modo de energia: Ahorro de energia";
            energy.style.color = "red";
            energy.style.fontWeight = "bold";
        } else {
            energy.innerHTML = "Modo de energia: Rendimiento";
            energy.style.color = "green";
            energy.style.fontWeight = "bold";
        }
    }
    // Initial call
    updateEnergyStatus();
    // Set interval to update every 10 seconds
    setInterval(updateEnergyStatus, 10000);
    
console.log('DOM fully loaded and parsed');
}
var menu = document.getElementById('menu');
var sideMenu = document.getElementById('side-menu');
var closeMenu = document.getElementById('close-menu');
var homeButton = document.getElementById('home');
menu.addEventListener('click', () => {
    sideMenu.style.display = 'block';
    setTimeout(() => {
        sideMenu.style.animation = 'none';
        bodyLoad.style.animation = 'none';
    }, 302);
    sideMenu.style.animation = 'slide-in 0.5s ease';
});
homeButton.addEventListener('click', () => {
  setTimeout(() => {
        sideMenu.style.display = 'none';
        sideMenu.style.animation = 'none';

    }, 298);
    sideMenu.style.animation = 'slide-out 0.5s ease';
    userContainer.style.display = 'none';
    currentMenu.innerHTML = 'Peticion Forzada';
    LoginContainer.style.display = 'none';
    worldSettingsForm.style.display = 'none';
});

closeMenu.addEventListener('click', () => {
    setTimeout(() => {
        sideMenu.style.display = 'none';
        sideMenu.style.animation = 'none';
    }, 298);
    sideMenu.style.animation = 'slide-out 0.5s ease';
});
var themeButton = document.getElementById('themes');
themeButton.addEventListener('click', () => {
    themeContainer.style.display = 'block';
    themeContainer.style.animation = 'open-menus 0.3s ease-in-out';
    backgroundOpacity.style.display = 'block';
});
var closeTheme = document.getElementById('close-theme');
closeTheme.addEventListener('click', () => {
    backgroundOpacity.style.display = 'none';
    setTimeout(() => {
        themeContainer.style.animation = 'none';
        themeContainer.style.display = 'none';
    }, 302);
    themeContainer.style.animation = 'close-menus 0.3s ease-in-out';
});
var userContainer = document.querySelector('.users-container');
var usersButton = document.getElementById('users');
var currentMenu = document.getElementById('currentmenu');
usersButton.addEventListener('click', () => {
    userContainer.style.display = 'flex';
    sideMenu.style.animation = 'slide-out 0.5s ease';
    currentMenu.innerHTML = 'Mijos del server';
    LoginContainer.style.display = 'none';
    worldSettingsForm.style.display = 'none';
    setTimeout(() => {
        sideMenu.style.animation = 'none';
        sideMenu.style.display = 'none';
    }, 302);

});
var statusElements = document.querySelectorAll('.user-card-status');
statusElements.forEach((statusElement) => {
    const userCard = statusElement.closest('.user-card');
    const userId = userCard.getAttribute('user-id');
    const userName = userCard.querySelector('.user-card-name').textContent;

    if (!userId) {
        statusElement.textContent = 'Estado: Error ID no encontrado';
        return;
    }

    fetch('banned_users.txt')
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to load banned users file');
            }
            return response.text();
        })
    

        .then(data => {
            // First split and filter empty lines
            const bannedUsers = data.split('\n')
                .filter(line => line && line.trim().length > 0) // Remove empty lines
                .map(line => {
                    try {
                        const [id, endTime] = line.trim().split(',');
                        if (!id || !endTime) {
                            console.warn('Invalid line format:', line);
                            return null;
                        }
                        return {
                            id: id.trim(),
                            endTime: new Date(endTime.trim())
                        };
                    } catch (err) {
                        console.warn('Error parsing line:', line, err);
                        return null;
                    }
                })
                .filter(user => user !== null); // Remove failed parses
            
            const bannedUser = bannedUsers.find(user => user.id === userId);

            if (bannedUser && !isNaN(bannedUser.endTime.getTime())) {
                const now = new Date();
                const endTime = bannedUser.endTime;
                
                if (now < endTime) {
                    const timeLeft = endTime - now;
                    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    
                    statusElement.innerHTML = `
                        Estado: <span class="user-card-banned-text">Baneado</span><br>
                        <span class="ban-time">Tiempo restante: ${days}d ${hours}h ${minutes}m</span>
                    `;
                    statusElement.classList.add('banned');
                    userCard.classList.add('banned-user');
                } else {
                    statusElement.textContent = 'Estado: Desbaneado';
                    statusElement.classList.remove('banned');
                    userCard.classList.remove('banned-user');
                }
            } else {
                statusElement.textContent = 'Estado: No baneado';
                statusElement.classList.remove('banned');
                userCard.classList.remove('banned-user');
            }
                            if (userId === '1') {
            statusElement.innerHTML = `
            <span>Estado: </span><span class="user-card-admin-text">Es admin</span>`;
            statusElement.classList.remove('banned');
            userCard.classList.remove('banned-user');
        
        }
        if (userId === '2') {
            statusElement.innerHTML = `
            <span>Estado: </span><span class="user-card-moderator-text">Es moderador</span>`;
            statusElement.classList.remove('banned');
            userCard.classList.remove('banned-user');
            
        }
        if (userName === 'Minivers097') {
            statusElement.innerHTML = `
            Estado: No baneada`;
            statusElement.classList.remove('banned');
            userCard.classList.remove('banned-user');
        }

        })

        .catch(error => {
            console.error('Error loading banned users:', error);
            statusElement.textContent = 'Estado: Error al cargar';
        });
});
    </script>
    <script>
        var cookiexp = document.getElementById('cookieexp');
        var cookie = getCookie('theme');
       if (cookie) {
           var expires = new Date();
           expires.setTime(expires.getTime() + (7 * 24 * 60 * 60 * 1000));
           cookiexp.innerHTML = `Expira el: ${expires.toUTCString()}`;
       } else {
           cookiexp.innerHTML = `Expira el: --`;
       }

   function setCookie(name, value, days) {
       const expires = new Date();
       expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
       document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
   }

   function getCookie(name) {
       const value = `; ${document.cookie}`;
       const parts = value.split(`; ${name}=`);
       if (parts.length === 2) return parts.pop().split(';').shift();
    return null;
}

// Theme handling
const themeStyle = document.createElement('link');
const moderntheme = document.getElementById('modern');
const classicTheme = document.getElementById('classic');
const currentTheme = document.getElementById('current-theme');
const themeContainer = document.getElementById('themeContainer');
const backgroundOpacity = document.getElementById('background-opacity');
themeStyle.rel = 'stylesheet';
document.head.appendChild(themeStyle);

function setTheme(theme) {
    themeStyle.setAttribute('href', `${theme}.css`);
    setCookie('theme', theme, 7);
    currentTheme.innerHTML = `Tema actual: ${theme === 'classic' ? 'Clasico' : 'Moderno'}`;
}

// Initialize theme from cookie or default to classic
document.addEventListener('DOMContentLoaded', () => {
    const savedTheme = getCookie('theme') || 'classic';
    setTheme(savedTheme);
});

// Update your existing theme button listeners
moderntheme.addEventListener('click', () => {
    setTheme('modern');
});

classicTheme.addEventListener('click', () => {
    setTheme('classic');
});
var LoginButton = document.getElementById('account');
var LoginContainer = document.querySelector('.login-container');

LoginButton.addEventListener('click', () => {
    LoginContainer.style.display = 'flex';
    worldSettingsForm.style.display = 'none';
    sideMenu.style.animation = 'slide-out 0.5s ease';
    currentMenu.innerHTML = 'Iniciar Sesion';
    setTimeout(() => {
        sideMenu.style.animation = 'none';
        sideMenu.style.display = 'none';
    }, 302);
});

</script>
<script>
// User data from cards
function getUsersFromCards() {
    const userCards = document.querySelectorAll('.user-card');
    return Array.from(userCards).map(card => ({
        id: card.getAttribute('user-id'),
        username: card.querySelector('.user-card-name').textContent.trim(),
        isAdmin: card.classList.contains('admin'),
        isModerator: card.classList.contains('moderator')
    }));
}

// Login handling
function handleLogin() {
    const username = document.getElementById('username').value;
    const users = getUsersFromCards();
    const user = users.find(u => u.username.toLowerCase() === username.toLowerCase());

    if (user) {
        // Set login cookie
        setCookie('loggedInUser', JSON.stringify(user), 7);
        updateLoginState();
        LoginContainer.style.display = 'none';
        currentMenu.innerHTML = 'Peticion Forzada';
        alert('Inicio de sesión exitoso!');
        // Check if user is banned
        checkUserBanStatus();
    } else {
        alert('Usuario no encontrado');
    }
}

// Update UI based on login state
function updateLoginState() {
    const loginButton = document.getElementById('account');
    const worldSettingsButton = document.getElementById('worldsettings');
    const loggedInUser = getCookie('loggedInUser');

    if (loggedInUser) {
        const user = JSON.parse(loggedInUser);
        loginButton.textContent = user.username;
        loginButton.classList.add('logged-in');
        
        // Show world settings only for admin/moderator
        if (user.isAdmin || user.isModerator || loggedInUser) {
            worldSettingsButton.style.display = 'block';
        } else {
            worldSettingsButton.style.display = 'none';
        }
    } else {
        loginButton.textContent = 'Iniciar Sesión';
        loginButton.classList.remove('logged-in');
        worldSettingsButton.style.display = 'none';
    }
}

// Logout function
function handleLogout() {
    document.cookie = 'loggedInUser=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
    updateLoginState();
    alert('Sesión cerrada');
}

// Initialize login state
document.addEventListener('DOMContentLoaded', () => {
    updateLoginState();
    
    // Add login button listener
    const loginButton = document.getElementById('login');
    loginButton.addEventListener('click', handleLogin);
    
    // Add logout functionality to account button when logged in
    const accountButton = document.getElementById('account');
    accountButton.addEventListener('click', () => {
        if (getCookie('loggedInUser')) {
            if (confirm('¿Deseas cerrar sesión?')) {
                handleLogout();
            } else {
                // Return to home if logout is canceled
                userContainer.style.display = 'none';
                currentMenu.innerHTML = 'Peticion Forzada';
                LoginContainer.style.display = 'none';
                sideMenu.style.animation = 'slide-out 0.5s ease';
                setTimeout(() => {
                    sideMenu.style.animation = 'none';
                    sideMenu.style.display = 'none';
                }, 502);
            }
        } else {
            LoginContainer.style.display = 'flex';
            sideMenu.style.animation = 'slide-out 0.5s ease';
            currentMenu.innerHTML = 'Iniciar Sesion';
            setTimeout(() => {
                sideMenu.style.animation = 'none';
                sideMenu.style.display = 'none';
            }, 302);
        }
        
    });
});
var bannedToast = document.getElementById('bannedToast');
var closeToastButton = document.getElementById('closeToast');
var banDuration = document.getElementById('banDuration');
var loggedInUser = getCookie('loggedInUser');

function checkUserBanStatus() {
    if (!loggedInUser) return;
    
    const user = JSON.parse(loggedInUser);
    const userId = user.id;

    fetch('banned_users.txt')
        .then(response => {
            if (!response.ok) throw new Error('Failed to load banned users file');
            return response.text();
        })
        .then(data => {
            const bannedUsers = data.split('\n')
                .filter(line => line && line.trim().length > 0)
                .map(line => {
                    try {
                        const [id, endTime] = line.trim().split(',');
                        return {
                            id: id.trim(),
                            endTime: new Date(endTime.trim())
                        };
                    } catch (err) {
                        console.warn('Error parsing ban data:', err);
                        return null;
                    }
                })
                .filter(user => user !== null);

            const bannedUser = bannedUsers.find(banned => banned.id === userId);
            
            if (bannedUser) {
                const now = new Date();
                const endTime = bannedUser.endTime;
                
                if (now < endTime) {
                    const timeLeft = endTime - now;
                    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    
                    banDuration.textContent = `${days}d ${hours}h ${minutes}m`;
                    bannedToast.style.display = 'flex';
                    bannedToast.style.animation = 'fadeIn 0.5s ease-in-out';
                    setTimeout(() => {
                        bannedToast.style.animation = 'none';
                        bannedToast.style.display = 'none';

                    }, 5300);
                    setTimeout (() => {
                        bannedToast.style.animation = 'fadeOut 0.3s ease-in-out';
                        
                    }, 5000);
                    
                    // Update user cookie with ban status
                    user.isBanned = true;
                    user.banEndTime = endTime;
                    setCookie('loggedInUser', JSON.stringify(user), 7);
                }
            }
        })
        .catch(error => {
            console.error('Error checking ban status:', error);
        });
}

// Check ban status on login and page load
document.addEventListener('DOMContentLoaded', checkUserBanStatus);

// Update toast close button
closeToastButton.addEventListener('click', () => {
    bannedToast.style.animation = 'fadeOut 0.3s ease-in-out';
    setTimeout(() => {
        bannedToast.style.display = 'none';
        bannedToast.style.animation = 'none';
    }, 290);
});

// Update login handler to check ban status
const originalHandleLogin = handleLogin;
handleLogin = function() {
    originalHandleLogin();
    checkUserBanStatus();
};
</script>
<script>
// World Settings Handler
const worldSettingsForm = document.querySelector('.worldsettings-container');
const difficultySelect = document.getElementById('difficulty');
const worldFileInput = document.getElementById('worldFile');
const saveWorldSettings = document.getElementById('saveWorldSettings');

// Add Telegram bot credentials
const settingsBotToken = '7529214947:AAFq5gh_ZvzjNNBtYTSCVJlGwwml5Hy2OYY';
const settingsChatId = '7688071745';

saveWorldSettings.addEventListener('click', async () => {
    const loggedInUser = getCookie('loggedInUser');
    
    if (!loggedInUser) {
        alert('Debes iniciar sesión para cambiar la configuración');
        return;
    }

    const user = JSON.parse(loggedInUser);
    const selectedDifficulty = difficultySelect.value;
    const file = worldFileInput.files[0];
    
    let message = `🔧 Cambios en la configuración del mundo:\n\n`;
    message += `👤 Usuario: ${user.username}\n`;
    message += `🎮 Dificultad: ${selectedDifficulty}\n`;

    if (file) {
        if (file.size > 100 * 1024 * 1024) { // 100MB limit
            alert('El archivo es demasiado grande. Máximo 100MB.');
            return;
        }

        const allowedTypes = ['.zip', '.mcpack'];
        const fileExtension = file.name.substring(file.name.lastIndexOf('.')).toLowerCase();
        
        if (!allowedTypes.includes(fileExtension)) {
            alert('Tipo de archivo no válido. Solo se permiten archivos .zip o .mcpack');
            return;
        }

        message += `📦 Pack subido: ${file.name}\n`;
        message += `📊 Tamaño: ${(file.size / 1024 / 1024).toFixed(2)}MB\n`;
    }

    // Add timestamp
    const now = new Date();
    message += `\n⏰ Fecha: ${now.toLocaleString()}\n`;


    // Send to Telegram
    try {
        const response = await fetch(`https://api.telegram.org/bot${settingsBotToken}/sendMessage`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                chat_id: settingsChatId,
                text: message,
                parse_mode: 'HTML'
            })
        });

        const data = await response.json();
        
        if (data.ok) {
            alert('Configuración guardada exitosamente!');
            
            // If there's a file, upload it as a document
            if (file) {
                const formData = new FormData();
                formData.append('chat_id', settingsChatId);
                formData.append('document', file);
                
                const fileResponse = await fetch(`https://api.telegram.org/bot${settingsBotToken}/sendDocument`, {
                    method: 'POST',
                    body: formData
                });
                
                const fileData = await fileResponse.json();
                if (!fileData.ok) {
                    throw new Error('Error al subir el archivo');
                }
            }
            
            // Clear file input
            worldFileInput.value = '';
            
            // Update installed packs display
            updateInstalledPacks(user.username, file?.name);
        } else {
            throw new Error(data.description || 'Error al guardar la configuración');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error al guardar la configuración: ' + error.message);
    }
});

function updateInstalledPacks(username, fileName) {
    // Find an empty slot or the oldest pack
    const packCards = document.querySelectorAll('.installed-pack-card');
    let targetCard = null;
    
    for (const card of packCards) {
        const packName = card.querySelector('div:nth-child(2)');
        if (packName.textContent === 'Pack 1' || 
            packName.textContent === 'Pack 2' || 
            packName.textContent === 'Pack 3') {
            targetCard = card;
            break;
        }
    }
    
    if (targetCard && fileName) {
        const packName = targetCard.querySelector('div:nth-child(2)');
        const installedBy = targetCard.querySelector('div:last-child');
        
        packName.textContent = fileName;
        installedBy.textContent = username;
    }
}
var worldSettingsButton = document.getElementById('worldsettings');
worldSettingsButton.addEventListener('click', () => {
    worldSettingsForm.style.display = 'flex';
    sideMenu.style.animation = 'slide-out 0.5s ease';
    currentMenu.innerHTML = 'Configuraciones del mundo';
    setTimeout(() => {
        sideMenu.style.animation = 'none';
        sideMenu.style.display = 'none';
    }, 302);
});
</script>

</body>
</html>

