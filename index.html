<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peticion Forzada</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
      
    </style>
</head>
<body>
        


<div class="body-load" id="bodyLoad">
    <div class="alert-container">
        <h3>&#9888; Solo puedes enviar 3 peticiones</h3>
        </div>
    
        <div class="background-opacity" id="background-opacity"></div>
        <div class="topbar">
            <button class="menu-bars" id="menu">&#9776;</button>
            <h2 id="currentmenu">Peticion Forzada</h2>
        </div>
        <div class="side-menu" id="side-menu">
            <div class="topbar">
            <h1>Menu</h1>
            <button class="menu-bars" id="close-menu">&#9776;</button>
            </div>
            <button class="side-menu-button" id="home">Inicio</button>
            <button class="side-menu-button" id="themes">Temas</button>
            <button class="side-menu-button" id="users">Mijos del server</button>
            <button class="side-menu-button" id="account">Iniciar Sesión</button>
            <button class="side-menu-button" id="logout">Reportar problemas</button>
            <button class="side-menu-button" id=""></button>
          <footer>&copy; 2025 El server de los papus</footer>
        </div>
        <div class="theme-container" id="themeContainer">
            <h1>Temas</h1>
            <h3>Selecciona un tema</h3>
            <p id="current-theme">Tema actual: </p>
            <button class="theme-button" id="modern">Moderno</button>
            <button class="theme-button" id="classic">Clasico</button>
            <button class="theme-button" id="close-theme">Cerrar</button>
        </div>
       
    <div class="container">
        
    <h1>Pedir que prendan server</h1>
    <button class="button" id="requestButton">Espera...</button>
    <h2 id="estado"></h2>
    <input id="messageInput" type="text" placeholder="Personalizar mensaje" id="messageInput" style="display:none;">
   <div style="display: none;" id="mobile-ui" class="button-container">
    <button id="refresh">Refrescar</button>
    <button id="problems">Reportar problemas</button>
    <button id="fixperf">¿Problemas de Rendimiento?</button>
   </div>
</div>
    <br>
    <div class="button-container">
    </div>
    <br>
    <div class="uptime">
        <h3 id="uptime">Tiempo activo: --d --h --m --s </h3>
        <div class="uptime-bar" id="uptime-bar"></div>
        <p id="health">---%</p>
        <p class="p" id="energy">Estado de energia: --</p>
        <p style="margin: 0; font-size: 12px; color: gray;" id="cookieexp">Expira en: --</p>
    </div>
    
    </div>
    <div class="users-container">
        <div class="users-cards">
            <div class="user-card">
                <p class="user-card-name">User 1</p>
                <p id="user-card-status" class="user-card-status">Estado: No se pudo conectar</p>
            </div>
            <div class="user-card">
                <p class="user-card-name">User 2</p>
                <p id="user-card-status" class="user-card-status">Estado: No se pudo conectar</p>
            </div>
            <div class="user-card">
                <p class="user-card-name">User 3</p>
                <p id="user-card-status" class="user-card-status">Estado: No se pudo conectar</p>
            </div>
            <div class="user-card">
                <p class="user-card-name">User 4</p>
                <p id="user-card-status" class="user-card-status">Estado: No se pudo conectar</p>
            </div>
        </div>
    </div>

    <script>
        // On page load
      document.onreadystatechange = function() {
            const isWebview = /wv|WebView|MobileApp/i.test(window.navigator.userAgent);

// Update the text based on the detection
const webviewElement = document.getElementById('webview');
const mobui = document.getElementById('mobile-ui');

// Refresh button functionality
const refreshButton = document.getElementById('refresh');
refreshButton.addEventListener('click', function() {
    location.reload(); // Reload the page
});
// Problems button functionality
const problemsButton = document.getElementById('problems');
problemsButton.addEventListener('click', function() {
    window.location.href = 'problemas.html'; //
});
// Fix performance button functionality
const fixperfButton = document.getElementById('fixperf');
   


        // Hide the loading screen after 2 second        // Token and chat ID for Telegram Bot
        const botToken = '7529214947:AAFq5gh_ZvzjNNBtYTSCVJlGwwml5Hy2OYY'; // Replace with your bot token
        const chatId = '7688071745';
        const url = `https://api.telegram.org/bot${botToken}/sendMessage`;

// Login button functionality
        

        var input = document.getElementById("messageInput");
        document.getElementById('requestButton').addEventListener('click', () => {
            // Get the value from the input field
            const inputValue = input.value;
            const message = 'Prende server, ' + inputValue;

            

            const data = {
                chat_id: chatId,
                text: message
            };

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.ok) {
                    alert('Mensaje enviado correctamente!');
                } else {
                    alert('Error: ' + data.description);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Fallo al enviar el mensaje.');
            });
        });

        setTimeout(function() {
        const serverAddress = "shopping-turtle.gl.at.ply.gg";
        const serverPort = "49732"; // Bedrock default is 19132
    
    
        // Fetch server status using an external API
        async function checkServerStatus() {
          try {
            const response = await fetch(`https://api.mcsrvstat.us/bedrock/2/${serverAddress}:${serverPort}`);
            const data = await response.json();
            console.log(data);
    
            var estado = document.getElementById("estado");
            var button = document.getElementById("requestButton");
            var messageInput = document.getElementById("messageInput");

    
            if (data.online) {
             estado.innerHTML = "El server esta activo... No hay necesidad de peticion";
             button.style.animation = "none";
             estado.style.color = "green";
             button.toggleAttribute("disabled", true);
             button.style.cursor = "not-allowed";
             button.style.background = "gray";
             button.classList.remove("peticion");
             button.style.pointerEvents = "none";
             button.innerHTML = "No puedes hacer peticion";
            } else {
              estado.innerHTML = "El server esta apagado... Realizar peticion";
              button.style.animation = "gradient-animation 12s ease infinite";
              messageInput.style.display = "block";
                estado.style.color = "red";
                button.style.pointerEvents = "auto";
                button.classList.add("peticion");
                button.innerHTML = "Realizar peticion";




                document.getElementById('requestButton').addEventListener('click', function() {
            
        });
            }
          } catch (error) {
        estado.innerHTML = "Error fetching server status";
            estado.style.color = "red";
            console.error("Error fetching server status:", error);
          }
        }
    
        checkServerStatus();
    }, 1000);
    var alertcontainer = document.querySelector('.alert-container');
    // Show the alert past 1AM
    var currentTime = new Date();
    var currentHour = currentTime.getHours();
    if (currentHour >= 1 && currentHour < 7) {
        setTimeout(function() {
            alertcontainer.style.display = 'block';
        }, 3000); // Show after 1 second
        setTimeout(function() {
            alertcontainer.style.display = 'none';
        }, 25000); // Hide after 5 seconds
    }

    async function fetchUptime() {
        try {
       const response = fetch('https://robin-pure-miserably.ngrok-free.app',
        {
    method: 'GET',
    headers: {
        'ngrok-skip-browser-warning': '67890'
    }
        });
        // Check if the response is ok (status in the range 200-299)
        
        
        if (!response.ok) throw new Error('Network response was not ok');
        const html = await response.text();

        // Parse the fetched HTML to extract uptime
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const uptimeText = doc.querySelector('p')?.textContent || 'No se encontro';

        // Log the extracted uptime for debugging
        console.log('Extracted Uptime:', uptimeText);

        // Get the DOM elements
        const uptimeElement = document.getElementById('uptime');
        const uptimeBar = document.getElementById('uptime-bar');

        // Update the uptime text
        if (uptimeElement) {
            uptimeElement.textContent = 'Tiempo activo: ' + uptimeText;
        } else {
            console.error('Element with ID "uptime" not found');
        }
 
        // Uptime bar health calculation in reverse from 100% to 0%
        const uptimeParts = uptimeText.split(' ');
        const uptimeValues = uptimeParts.map(part => parseInt(part) || 0);
        const totalSeconds = (uptimeValues[0] * 86400) + (uptimeValues[1] * 3600) + (uptimeValues[2] * 60) + uptimeValues[3];
        const maxSeconds = 86400 * 4; // Assuming a maximum of 4 days for the bar
        const healthPercentage = Math.max(0, Math.min(100, ((maxSeconds - totalSeconds) / maxSeconds) * 100));
        const healthElement = document.getElementById('health');
        if (healthElement) {
            healthElement.textContent = 'Vida del server: ' + Math.round(healthPercentage) + '%';
            uptimeBar.style.width = healthPercentage + '%';
            uptimeBar.style.transition = 'width 1s ease-in-out';
            uptimeBar.style.backgroundColor = healthPercentage > 40 ? 'seagreen' : (healthPercentage > 20 ? 'yellow' : 'red');
            const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
         
            if (healthPercentage < 5) {
                const message = 'El server esta por apagarse, tiempo activo: ' + uptimeText;

                const data = {
                    chat_id: chatId,
                    text: message
                };
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.ok) {
                        console.log('Mensaje enviado correctamente!');
                    } else {
                        console.error('Error al enviar el mensaje:', data.description);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        } else {
            console.error('Element with ID "health" not found');
        }


        
        // Update the uptime bar
    } catch (error) {
        console.error('Error fetching uptime:', error);
        const uptimeElement = document.getElementById('uptime');
        if (uptimeElement) {
            uptimeElement.textContent = 'El server no esta prendido o falta alguna configuracion';
        }  
    }
}

// Initial fetch
fetchUptime();

// Refresh uptime every 60 seconds
setInterval(fetchUptime, 60000);

    // Update energy status every 10 seconds
   function updateEnergyStatus() {
        var currentTime = new Date();
        var currentHour = currentTime.getHours();
        if (currentHour >= 3 && currentHour < 7) {
            energy.innerHTML = "Modo de energia: Ahorro de energia";
            energy.style.color = "red";
            energy.style.fontWeight = "bold";
        } else {
            energy.innerHTML = "Modo de energia: Rendimiento";
            energy.style.color = "green";
            energy.style.fontWeight = "bold";
        }
    }
    // Initial call
    updateEnergyStatus();
    // Set interval to update every 10 seconds
    setInterval(updateEnergyStatus, 10000);
    var commandButton = document.getElementById('commandSend');
    var commandInput = document.getElementById('commandInput');
    var commandResponse = document.getElementById('commandResponse');

commandButton.addEventListener('click', async () => {
    const command = commandInput.value;
    if (!command) {
        commandResponse.innerHTML = '<a style="color: red;">Porfavor escribe un comando.</a>';
        return;
    }

    try {
        const response = await fetch(`https://ludos.serveo.net/execute?cmd=${encodeURIComponent(command)}`);
        if (!response.ok) {
            throw new Error('Failed to execute command');
        }
        const result = await response.text();
        commandResponse.innerHTML = result;
    } catch (error) {
        console.error('Error:', error);
        commandResponse.innerHTML = '<a style="color: red;">Error ejecutando el comando</a>';
    }
});
console.log('DOM fully loaded and parsed');
}
var menu = document.getElementById('menu');
var sideMenu = document.getElementById('side-menu');
var closeMenu = document.getElementById('close-menu');
var homeButton = document.getElementById('home');
menu.addEventListener('click', () => {
    sideMenu.style.display = 'block';
    setTimeout(() => {
        sideMenu.style.animation = 'none';
        bodyLoad.style.animation = 'none';
    }, 302);
    sideMenu.style.animation = 'slide-in 0.5s ease';
});
homeButton.addEventListener('click', () => {
  setTimeout(() => {
        sideMenu.style.display = 'none';
        sideMenu.style.animation = 'none';

    }, 298);
    sideMenu.style.animation = 'slide-out 0.5s ease';
    userContainer.style.display = 'none';
    currentMenu.innerHTML = 'Peticion Forzada';
});

closeMenu.addEventListener('click', () => {
    setTimeout(() => {
        sideMenu.style.display = 'none';
        sideMenu.style.animation = 'none';
    }, 298);
    sideMenu.style.animation = 'slide-out 0.5s ease';
});
var themeButton = document.getElementById('themes');
themeButton.addEventListener('click', () => {
    themeContainer.style.display = 'block';
    themeContainer.style.animation = 'open-menus 0.3s ease-in-out';
    backgroundOpacity.style.display = 'block';
});
var closeTheme = document.getElementById('close-theme');
closeTheme.addEventListener('click', () => {
    backgroundOpacity.style.display = 'none';
    setTimeout(() => {
        themeContainer.style.animation = 'none';
        themeContainer.style.display = 'none';
    }, 302);
    themeContainer.style.animation = 'close-menus 0.3s ease-in-out';
});
var userContainer = document.querySelector('.users-container');
var usersButton = document.getElementById('users');
var currentMenu = document.getElementById('currentmenu');
usersButton.addEventListener('click', () => {
    userContainer.style.display = 'flex';
    sideMenu.style.animation = 'slide-out 0.5s ease';
    currentMenu.innerHTML = 'Mijos del server';
    setTimeout(() => {
        sideMenu.style.animation = 'none';
        sideMenu.style.display = 'none';
    }, 302);

});
var statusElements = document.querySelectorAll('.user-card-status');
statusElements.forEach((statusElement) => {
    const userCard = statusElement.closest('.user-card');
    const userName = userCard.querySelector('.user-card-name').textContent;
    const userId = userName.replace('User ', '');

    fetch('banned_users.txt')
        .then(response => response.text())
        .then(data => {
            const bannedUsers = data.split('\n')
                .map(line => line.trim())
                .filter(line => line)
                .map(line => {
                    const [id, endTime] = line.split(',');
                    return { id, endTime: new Date(endTime) };
                });
            
            const bannedUser = bannedUsers.find(user => user.id === userId);
            
            if (bannedUser) {
                const now = new Date();
                const endTime = new Date(bannedUser.endTime);
                
                if (now < endTime) {
                    // Still banned, calculate remaining time
                    const timeLeft = endTime - now;
                    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    
                    statusElement.innerHTML = `
                        Estado: <span class="user-card-banned-text">Baneado</span><br>
                        <span class="ban-time">Tiempo restante: ${days}d ${hours}h ${minutes}m</span>
                    `;
                    statusElement.classList.add('banned');
                    userCard.classList.add('banned-user');
                } else {
                    // Ban expired
                    statusElement.textContent = 'Estado: Desbaneado';
                    statusElement.classList.remove('banned');
                    userCard.classList.remove('banned-user');
                }
            } else {
                // Not banned
                statusElement.textContent = 'Estado: No baneado';
                statusElement.classList.remove('banned');
                userCard.classList.remove('banned-user');
            }
        })
        .catch(error => {
            console.error('Error loading banned users:', error);
            statusElement.textContent = 'Estado: Error al cargar';
        });
});
    </script>
    <script>
        var cookiexp = document.getElementById('cookieexp');
        var cookie = getCookie('theme');
       if (cookie) {
           var expires = new Date();
           expires.setTime(expires.getTime() + (7 * 24 * 60 * 60 * 1000));
           cookiexp.innerHTML = `Expira el: ${expires.toUTCString()}`;
       } else {
           cookiexp.innerHTML = `Expira el: --`;
       }

   function setCookie(name, value, days) {
       const expires = new Date();
       expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
       document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
   }

   function getCookie(name) {
       const value = `; ${document.cookie}`;
       const parts = value.split(`; ${name}=`);
       if (parts.length === 2) return parts.pop().split(';').shift();
    return null;
}

// Theme handling
const themeStyle = document.createElement('link');
const moderntheme = document.getElementById('modern');
const classicTheme = document.getElementById('classic');
const currentTheme = document.getElementById('current-theme');
const themeContainer = document.getElementById('themeContainer');
const backgroundOpacity = document.getElementById('background-opacity');
themeStyle.rel = 'stylesheet';
document.head.appendChild(themeStyle);

function setTheme(theme) {
    themeStyle.setAttribute('href', `${theme}.css`);
    setCookie('theme', theme, 7);
    currentTheme.innerHTML = `Tema actual: ${theme === 'classic' ? 'Clasico' : 'Moderno'}`;
}

// Initialize theme from cookie or default to classic
document.addEventListener('DOMContentLoaded', () => {
    const savedTheme = getCookie('theme') || 'classic';
    setTheme(savedTheme);
});

// Update your existing theme button listeners
moderntheme.addEventListener('click', () => {
    setTheme('modern');
});

classicTheme.addEventListener('click', () => {
    setTheme('classic');
});

</script>
</body>
</html>

